html
	head
		link(rel='stylesheet' href='css/style.css')
		link(rel='stylesheet' href='https://fonts.googleapis.com/css?family=Unica+One')
		script(src="https://code.jquery.com/jquery-3.1.1.js"
		integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
		crossorigin="anonymous")
		script(src="https://code.highcharts.com/stock/highstock.js")
		script(src="https://code.highcharts.com/stock/modules/exporting.js")
		script(src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js')

	body

		div(id="container") 
			script.

				stock = '#{stock}'; 
				// Fetch data from Quandl API
				$(function createChart(){
					$.getJSON('https://www.quandl.com/api/v3/datasets/WIKI/' + stock +'/data.json?api_key=6Wkrs1ujpP3GXWTVrSEk', function(data){
						
						// Find the Stock information 
						var rawDataPoints = data.dataset_data.data; 
						var dataPoints = rawDataPoints.map((value) => {
							var date = moment(moment(value[0], "YYYY-MM-DD").unix()*1000);
							return [date._i, value[4]]; 
						}); 

						dataPoints.sort(function(a,b){
						return a[0] - b[0];
						});

						Highcharts.stockChart('container', {

							rangeSelector: {
								selected: 1
							},

							title: {
								text: 'Waterloo Stock Exchange', 
								style: {
									'color': 'black'
								}
							}, 				        

							tooltip: {
								pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
								valueDecimals: 2,
								split: true
							},

							credits: {
								position: {
									align: 'left',
									verticalAlign: 'bottom',
									x: -300,
									y: -10
								}
							},

							series: [{
								name: stock,
								data: dataPoints, 
								tooltip:{
									valueDecimals: 2
								}
							}]
						});
					});
				});


		// Input container 
		div.input-container
			div.form-container
				form(method="post", action="/stock")
					input(type='text', name='stock' placeholder="Search for a stock") 
					button(type='submit') Go
			div.stock-info
				div.stock-name 
					h1#stockName #{stock}

	
				

			

				

				

		



				